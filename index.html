<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Псевдоанонимизация Excel-таблиц v0.1</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Псевдоанонимизация Excel-таблиц v0.1</h1>
        
        <!-- Загрузка файла и управление -->
        <div class="section">
            <h2>Загрузка файла</h2>
            <div class="file-controls">
                <div class="control-item">
                    <label for="fileInput">Выбор файла XLSX:</label>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" />
                </div>
                <div class="control-item" id="sheetSelectionContainer" style="display: none;">
                    <label for="sheetSelect">Выбор листа:</label>
                    <select id="sheetSelect"></select>
                </div>
                <div class="control-item">
                    <button onclick="clearAll()">Очистить</button>
                </div>
            </div>
        </div>

        <!-- Исходная и токенизированная таблицы -->
        <div class="section" id="tablesSection" style="display: none;">
            <h2>Исходная таблица и результат токенизации</h2>
            <div class="tables-layout">
                <div class="table-wrapper">
                    <h3>Исходная таблица</h3>
                    <div class="table-container" id="originalTableContainer">
                        <table id="originalTable"></table>
                    </div>
                </div>
                <div class="table-wrapper">
                    <h3>Результат токенизации</h3>
                    <div class="table-container" id="tokenizedTableContainer">
                        <table id="tokenizedTable"></table>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button onclick="tokenizeColumns()">Токенизировать</button>
            </div>
        </div>

        <!-- Экспорт -->
        <div class="section" id="exportSection" style="display: none;">
            <h2>Экспорт результата</h2>
            <div class="export-controls">
                <button onclick="downloadCSV()">Скачать CSV</button>
                <button onclick="downloadXLSX()">Скачать XLSX</button>
                <button onclick="downloadJSON()">Скачать JSON-словарь</button>
                <button class="toggle-button" onclick="togglePromptHint(this)">▶ Промпт для нейросети</button>
            </div>
            <div class="prompt-hint-content" id="promptHintContent" style="display: none;">
                <textarea id="promptText" readonly>В тексте ниже встречаются токены вида [[...]]. Это псевдоанонимизированные значения: они заменяют исходные данные и расшифровываются только по отдельному JSON-словарю соответствий.
Жёсткое правило: не изменяй токены [[...]] ни при каких условиях.
(1) Не меняй внутри токена ни одного символа: буквы/цифры/знаки, регистр, длину.
(2) Не добавляй и не удаляй пробелы, переносы строк, кавычки или любые символы внутри токена.
(3) Не разбивай токен на части и не объединяй токены между собой.
(4) Не пытайся "расшифровать" токены, не придумывай исходные значения.
(5) Если нужно сослаться на значение — используй токен ровно как он дан, целиком, включая [[ и ]].
Если токен встречается несколько раз — считай, что это одно и то же значение.</textarea>
                <button class="copy-button" onclick="copyPromptHint(this)">Копировать</button>
            </div>
        </div>

        <!-- Детокенизация -->
        <div class="section" id="detokenizationSection">
            <h2>Детокенизация</h2>
            
            <div class="detokenization-controls">
                <div class="control-group">
                    <label for="jsonInput">Импорт JSON-словаря:</label>
                    <input type="file" id="jsonInput" accept=".json" />
                </div>
            </div>

            <div class="detokenization-layout">
                <div class="text-area-container">
                    <label for="responseTextarea">Ответ нейросети (сырой):</label>
                    <textarea id="responseTextarea" placeholder="Вставьте текст с токенами [[...]]"></textarea>
                </div>
                
                <div class="tokens-list-container">
                    <h3>Найденные токены</h3>
                    <div id="tokensList"></div>
                </div>
            </div>

            <div class="statistics" id="statistics" style="display: none;">
                <div class="stat-item"><strong>Длина текста:</strong> <span id="textLength">0</span> символов</div>
                <div class="stat-item"><strong>Всего токенов:</strong> <span id="totalTokens">0</span> (вхождения)</div>
                <div class="stat-item"><strong>Уникальных токенов:</strong> <span id="uniqueTokens">0</span></div>
                <div class="stat-item"><strong>Found:</strong> <span id="foundTokens">0</span></div>
                <div class="stat-item"><strong>Not found:</strong> <span id="notFoundTokens">0</span></div>
            </div>

            <div class="detokenized-result">
                <div class="result-header">
                    <h3>Ответ (детокенизированный)</h3>
                    <button class="copy-button" onclick="copyDetokenizedText(this)">Копировать</button>
                </div>
                <div id="detokenizedText" class="result-text"></div>
            </div>
        </div>
    </div>

    <script src="xlsx.full.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
